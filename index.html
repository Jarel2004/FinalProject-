<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Foods Restaurant - Korean Delights</title>

    <!-- ICONS + CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <div class="logo">
            <img src="logg.png" class="brand-logo" />
            <h1>Karu-mata</h1>
        </div>

        <!-- RIGHT SIDE ICONS -->
        <div class="nav-icons">

            <div class="restaurant-info">
                <div class="info-item">
                    <i class="fas fa-clock"></i>
                    <span>Open: 10:00 AM â€“ 9:00 PM</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-bolt"></i>
                    <span>Meals ready in 15-20 minutes</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-motorcycle"></i>
                    <span>Delivery available</span>
                </div>
            </div>

            <!-- Cart Button -->
            <div class="btns">
                <button id="cart-button" class="cart-circle" onclick="window.location.href='./cart/cart.html'">
                    <i class="fas fa-shopping-bag"></i>
                    <span id="cart-count">0</span>
                </button>

                <!-- Profile Button -->
                <button id="profile-toggle" class="profile-circle">
                    <i class="fas fa-user"></i>
                </button>
            </div>

        </div>

    </header>

   <!-- FILTER SECTION -->
    <div class="main-container">
        <div class="filter-section">
            <h2 class="filter-title"><i class="fas fa-filter"></i> Filter by Category</h2>

            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="best">Best Sellers</button>
                <button class="filter-btn" data-filter="sushi">Sushi</button>
                <button class="filter-btn" data-filter="sizzling">Sizzling</button>
            </div>

        </div>

        <!-- PRODUCT SECTION -->
        <div class="content-wrapper">
            <div class="products-section">
                <h2 class="section-title"><i class="fas fa-store"></i> Korean Delights</h2>

                <div class="products-grid" id="products-grid">
                    <!-- JS inserts product cards here -->
                </div>
            </div>
        </div>
    </div>


    <footer>
        <p>Â© 2023 K-Foods Restaurant. All rights reserved.</p>
        <p>Experience authentic Korean flavors made with passion and tradition.</p>
    </footer>
    


    <!-- ============================= -->
    <!-- PROFILE SIDEBAR (Slide Right) -->
    <!-- ============================= -->

    <div id="profile-sidebar" class="profile-sidebar">

        <div class="profile-header">
            <div class="profile-avatar">
                <i class="fas fa-user-circle"></i>
            </div>

            <div class="profile-info">
                <h3 class="profile-name">Welcome, Guest!</h3>
                <p class="profile-email">guest@kfoods.com</p>

                <button class="login-btn">Sign In / Register</button>
            </div>

            <button class="close-profile">&times;</button>
        </div>

        <div class="profile-content">

            <div class="profile-section">
                <h4><i class="fas fa-map-marker-alt"></i> Delivery Location</h4>
                <p class="current-address">123 Main Street, Barangay 1, Manila 1000</p>

                <button class="manage-address-btn">
                    <i class="fas fa-edit"></i> Manage Addresses
                </button>
            </div>

            <div class="profile-section">
                <h4><i class="fas fa-history"></i> Order History</h4>

                <div class="order-item">
                    <p>Order #KFD235293 â€” 1 item</p>
                    <span>P140</span>
                </div>

                <div class="order-item">
                    <p>Order #KFD069561 â€” 1 item</p>
                    <span>P140</span>
                </div>

            </div>
        </div>

        <div class="profile-footer">
            <button class="logout-btn"><i class="fas fa-sign-out-alt"></i> Log Out</button>
        </div>

    </div>

    <!-- JAVASCRIPT -->
    <script>
// ===========================
// PRODUCT DATA (UPDATED FOR CART INTEGRATION)
// ===========================
const products = [
    {
        id: 1,
        name: "Bibimbap",
        category: ["best", "sizzling"],
        price: 150,
        image: "https://i.imgur.com/1R5U1oJ.jpeg",
        rating: 4.8,
        reviews: 1200,
        orders: 1900,
        description: "A colorful and comforting Korean rice bowl topped with seasoned vegetables, marinated beef, fried egg, and spicy gochujang sauce. Served warm and mixed just before eating.",
        tags: ["ðŸ”¥ Bestseller", "â± 20â€“30 mins", "ðŸ· Free utensils"],
        spicy: "ðŸŒ¶ Spicy Â· Korean Rice Bowl",
        addons: [
            { name: "Extra Rice", description: "White rice", price: 20 },
            { name: "Extra Egg", description: "Sunny side up", price: 25 },
            { name: "Extra Cheese", description: "Mozzarella", price: 30 },
            { name: "Kimchi Side", description: "100g portion", price: 40 },
            { name: "Iced Tea", description: "Regular glass", price: 35 }
        ]
    },
    {
        id: 2,
        name: "Kimchi Fried Rice",
        category: ["best"],
        price: 140,
        image: "https://i.imgur.com/9xZK2lM.jpeg",
        rating: 4.7,
        reviews: 980,
        orders: 1500,
        description: "Savory fried rice with tangy kimchi, vegetables, and topped with a fried egg. A perfect blend of spicy and umami flavors.",
        tags: ["ðŸŒ¶ Spicy", "â± 15â€“20 mins", "ðŸ”¥ Popular"],
        spicy: "ðŸŒ¶ Spicy Â· Fried Rice",
        addons: [
            { name: "Extra Kimchi", description: "Fermented cabbage", price: 30 },
            { name: "Extra Egg", description: "Sunny side up", price: 25 },
            { name: "Pork Belly", description: "Grilled slices", price: 50 }
        ]
    },
    {
        id: 3,
        name: "Korean Fried Chicken",
        category: ["best", "sizzling"],
        price: 180,
        image: "https://i.imgur.com/5kQXzJH.jpeg",
        rating: 4.9,
        reviews: 2100,
        orders: 3200,
        description: "Crispy double-fried chicken glazed with sweet and spicy sauce. Perfectly crunchy on the outside, juicy on the inside.",
        tags: ["ðŸ”¥ #1 Bestseller", "â± 25â€“35 mins", "ðŸŽ‰ Fan Favorite"],
        spicy: "ðŸŒ¶ Spicy Â· Fried Chicken",
        addons: [
            { name: "Extra Sauce", description: "Sweet & spicy", price: 15 },
            { name: "Pickled Radish", description: "Traditional side", price: 20 },
            { name: "Coleslaw", description: "Fresh salad", price: 30 },
            { name: "Soda", description: "Regular can", price: 40 }
        ]
    },
    {
        id: 4,
        name: "Tteokbokki",
        category: ["sushi"],
        price: 120,
        image: "https://i.imgur.com/wK7xY5T.jpeg",
        rating: 4.6,
        reviews: 850,
        orders: 1100,
        description: "Chewy rice cakes in sweet and spicy gochujang sauce with fish cakes and boiled eggs. A classic Korean street food.",
        tags: ["ðŸŒ¶ Very Spicy", "â± 15â€“20 mins", "ðŸœ Street Food"],
        spicy: "ðŸŒ¶ Very Spicy Â· Rice Cakes",
        addons: [
            { name: "Extra Rice Cakes", description: "10 pieces", price: 30 },
            { name: "Boiled Egg", description: "Soft-boiled", price: 20 },
            { name: "Cheese Topping", description: "Melted mozzarella", price: 35 }
        ]
    },
    {
        id: 5,
        name: "Bulgogi",
        category: ["sizzling"],
        price: 200,
        image: "https://i.imgur.com/7mP3zLK.jpeg",
        rating: 4.8,
        reviews: 1500,
        orders: 2000,
        description: "Thinly sliced beef marinated in a sweet soy-based sauce, grilled to perfection. Served with rice and lettuce wraps.",
        tags: ["ðŸ¥© Premium", "â± 30â€“40 mins", "ðŸ”¥ Must Try"],
        spicy: "ðŸ¥© Savory Â· Korean BBQ",
        addons: [
            { name: "Extra Rice", description: "White rice", price: 20 },
            { name: "Lettuce Wraps", description: "Fresh leaves", price: 25 },
            { name: "Ssamjang Sauce", description: "Dipping sauce", price: 15 }
        ]
    },
    {
        id: 6,
        name: "Japchae",
        category: ["sushi"],
        price: 160,
        image: "https://i.imgur.com/nQ8vR2P.jpeg",
        rating: 4.7,
        reviews: 920,
        orders: 1300,
        description: "Stir-fried glass noodles with vegetables and beef in a savory-sweet sauce. Light yet flavorful.",
        tags: ["ðŸ¥— Healthy", "â± 20â€“25 mins", "ðŸŒ¿ Vegetable-Rich"],
        spicy: "ðŸ¥— Mild Â· Glass Noodles",
        addons: [
            { name: "Extra Noodles", description: "Glass noodles", price: 35 },
            { name: "Extra Beef", description: "Marinated slices", price: 50 },
            { name: "Sesame Oil", description: "For extra flavor", price: 10 }
        ]
    }
];

// ===========================
// GLOBAL VARIABLES
// ===========================
let currentProduct = null;
let modalQuantity = 1;

// ===========================
// CART MANAGEMENT (UPDATED FOR CART INTEGRATION)
// ===========================
function getCart() {
    return JSON.parse(localStorage.getItem("kfoods-cart") || "[]");
}

function saveCart(cart) {
    localStorage.setItem("kfoods-cart", JSON.stringify(cart));
}

function updateCartCount() {
    const cartCountEl = document.getElementById("cart-count");
    if (cartCountEl) {
        const cart = getCart();
        const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
        cartCountEl.textContent = totalItems || 0;
        console.log("Cart count updated:", totalItems);
    }
}

// Save products to localStorage for cart page access
function saveProductsToStorage() {
    // Format products for cart page compatibility
    const productsForCart = products.map(product => ({
        id: product.id,
        name: product.name,
        price: product.price,
        description: product.description,
        category: product.category[0] || "best",
        bestSeller: product.category.includes("best"),
        icon: getIconForCategory(product.category[0])
    }));
    
    localStorage.setItem('kfoods-products', JSON.stringify(productsForCart));
    console.log("Products saved to localStorage for cart page");
}

// Helper function to get icon based on category
function getIconForCategory(category) {
    const iconMap = {
        'best': 'fas fa-star',
        'sizzling': 'fas fa-fire',
        'sushi': 'fas fa-sushi',
        'meal': 'fas fa-bowl-rice',
        'side': 'fas fa-utensil-spoon',
        'snack': 'fas fa-mortar-pestle'
    };
    return iconMap[category] || 'fas fa-utensils';
}

// ===========================
// RENDER PRODUCTS
// ===========================
function renderProducts(filter = "all") {
    const grid = document.getElementById("products-grid");
    if (!grid) {
        console.error("Products grid not found!");
        return;
    }
    
    grid.innerHTML = "";

    const filtered = products.filter(p => {
        if (filter === "all") return true;
        return p.category.includes(filter);
    });

    filtered.forEach(product => {
        const card = document.createElement("div");
        card.className = "product-card";
        card.style.cursor = "pointer";
        
        card.innerHTML = `
            <div class="product-image">
                <img src="${product.image}" alt="${product.name}" loading="lazy">
            </div>
            <div class="product-content">
                <h3 class="product-title">${product.name}</h3>
                <p class="product-description">${product.description.substring(0, 80)}...</p>
                <div class="product-footer">
                    <div class="product-price">â‚±${product.price.toFixed(2)}</div>
                    <button class="add-btn" onclick="event.stopPropagation(); openProductModal(${product.id})">
                        + Add
                    </button>
                </div>
            </div>
        `;
        
        // Add click event to open modal
        card.addEventListener("click", function() {
            openProductModal(product.id);
        });
        
        grid.appendChild(card);
    });

    console.log(`Rendered ${filtered.length} products for filter: ${filter}`);
}

// ===========================
// PRODUCT MODAL
// ===========================
function openProductModal(productId) {
    console.log("Opening modal for product:", productId);
    
    currentProduct = products.find(p => p.id === productId);
    if (!currentProduct) {
        console.error("Product not found!");
        return;
    }

    modalQuantity = 1;

    // Remove existing modal if any
    const existingModal = document.getElementById("productModalBackdrop");
    if (existingModal) {
        existingModal.remove();
    }

    // Create modal
    const modalHTML = `
        <div id="productModalBackdrop" class="modal-backdrop show">
            <div class="modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <div class="modal-title">${currentProduct.name}</div>
                    <button class="modal-close" onclick="closeProductModal()">&times;</button>
                </div>
                
                <div class="modal-sub">
                    ${currentProduct.spicy}
                </div>
                
                <div style="margin-bottom: 12px;">
                    <span style="color: #ffb000; font-size: 16px;">â˜…</span>
                    <span style="font-size: 13px; color: #777;">${currentProduct.rating} (${currentProduct.reviews.toLocaleString()} reviews)</span>
                    <span style="font-size: 13px; color: #777;"> â€¢ </span>
                    <span style="font-size: 13px; color: #777;">${currentProduct.orders.toLocaleString()}+ orders this week</span>
                </div>
                
                <div style="font-size: 22px; font-weight: 700; color: #d32f2f; margin-bottom: 12px;">
                    â‚±${currentProduct.price.toFixed(2)}
                </div>
                
                <p style="font-size: 14px; color: #666; line-height: 1.6; margin-bottom: 12px;">
                    ${currentProduct.description}
                </p>
                
                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px;">
                    ${currentProduct.tags.map(tag => `<span class="info-tag">${tag}</span>`).join('')}
                </div>

                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding: 12px; background: #f9f9f9; border-radius: 12px;">
                    <span style="font-size: 14px; font-weight: 500; color: #333;">Quantity</span>
                    <div class="qty-box">
                        <button class="qty-btn" onclick="changeModalQty(-1)">âˆ’</button>
                        <input type="number" id="modalQtyInput" class="qty-input" value="1" min="1" readonly>
                        <button class="qty-btn" onclick="changeModalQty(1)">+</button>
                    </div>
                </div>

                <div>
                    <div class="modal-section-title">Add-ons (Optional)</div>
                    <ul class="addons-list" id="modalAddonsList">
                        ${currentProduct.addons.map((addon, index) => `
                            <li class="addons-item">
                                <label>
                                    <input type="checkbox" class="addon-checkbox" data-index="${index}" onchange="updateModalTotal()">
                                    ${addon.name}
                                    <small>${addon.description}</small>
                                </label>
                                <span>+ â‚±${addon.price}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
                
                <div class="modal-footer">
                    <div>
                        <div class="total-label">Total to pay</div>
                        <div class="total-value" id="modalTotalPrice">â‚±${currentProduct.price.toFixed(2)}</div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button class="btn-secondary" onclick="closeProductModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="confirmAddToCart()" style="font-size:13px;">
                            Add to Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;

    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    // Close on backdrop click
    document.getElementById("productModalBackdrop").addEventListener("click", function(e) {
        if (e.target.id === "productModalBackdrop") {
            closeProductModal();
        }
    });

    document.body.style.overflow = "hidden";
    updateModalTotal();
    
    console.log("Modal opened for:", currentProduct.name);
}

function closeProductModal() {
    const backdrop = document.getElementById("productModalBackdrop");
    if (backdrop) {
        backdrop.classList.remove("show");
        setTimeout(() => {
            backdrop.remove();
        }, 300);
        document.body.style.overflow = "auto";
    }
    console.log("Modal closed");
}

function changeModalQty(delta) {
    modalQuantity = Math.max(1, modalQuantity + delta);
    const qtyInput = document.getElementById("modalQtyInput");
    if (qtyInput) {
        qtyInput.value = modalQuantity;
    }
    updateModalTotal();
}

function updateModalTotal() {
    if (!currentProduct) return;

    let addonsTotal = 0;
    const checkboxes = document.querySelectorAll(".addon-checkbox");
    checkboxes.forEach(cb => {
        if (cb.checked) {
            const index = parseInt(cb.dataset.index);
            addonsTotal += currentProduct.addons[index].price;
        }
    });

    const perUnit = currentProduct.price + addonsTotal;
    const total = perUnit * modalQuantity;
    
    const totalEl = document.getElementById("modalTotalPrice");
    if (totalEl) {
        totalEl.textContent = `â‚±${total.toFixed(2)}`;
    }
}

function confirmAddToCart() {
    if (!currentProduct) {
        console.error("No current product selected!");
        return;
    }

    console.log("Adding to cart:", currentProduct.name);
    
    let selectedAddons = [];
    let addonsTotal = 0;
    const checkboxes = document.querySelectorAll(".addon-checkbox");
    checkboxes.forEach(cb => {
        if (cb.checked) {
            const index = parseInt(cb.dataset.index);
            const addon = currentProduct.addons[index];
            addonsTotal += addon.price;
            selectedAddons.push({ name: addon.name, price: addon.price });
        }
    });

    const perUnit = currentProduct.price + addonsTotal;

    const cart = getCart();
    const existingIndex = cart.findIndex(item => 
        item.id === currentProduct.id && 
        JSON.stringify(item.addons) === JSON.stringify(selectedAddons)
    );

    if (existingIndex !== -1) {
        // Update quantity for existing item with same addons
        cart[existingIndex].quantity = (cart[existingIndex].quantity || 1) + modalQuantity;
        console.log("Updated existing item quantity:", cart[existingIndex].quantity);
    } else {
        // Add new item to cart
        const cartItem = {
            id: currentProduct.id,
            name: currentProduct.name,
            price: perUnit,
            quantity: modalQuantity,
            addons: selectedAddons,
            basePrice: currentProduct.price // Keep original price for reference
        };
        cart.push(cartItem);
        console.log("Added new item to cart:", cartItem);
    }

    saveCart(cart);
    updateCartCount();
    closeProductModal();
    showToast("âœ… Successfully Added to Cart!");
    
    // Log cart state for debugging
    console.log("Cart after adding:", cart);
}

function showToast(message) {
    let toast = document.getElementById("toastNotification");
    if (!toast) {
        toast = document.createElement("div");
        toast.id = "toastNotification";
        toast.className = "toast";
        document.body.appendChild(toast);
    }
    toast.textContent = message;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 2800);
}

// ===========================
// FILTER FUNCTIONALITY
// ===========================
function initializeFilters() {
    const filterBtns = document.querySelectorAll(".filter-btn");
    filterBtns.forEach(btn => {
        btn.addEventListener("click", function() {
            filterBtns.forEach(b => b.classList.remove("active"));
            this.classList.add("active");
            renderProducts(this.dataset.filter);
        });
    });
}

// ===========================
// PROFILE SIDEBAR
// ===========================
function initializeProfileSidebar() {
    const profileToggle = document.getElementById("profile-toggle");
    const profileSidebar = document.getElementById("profile-sidebar");
    const closeProfile = document.querySelector(".close-profile");

    if (profileToggle && profileSidebar) {
        profileToggle.addEventListener("click", function(e) {
            e.stopPropagation();
            profileSidebar.classList.add("open");
        });
    }

    if (closeProfile && profileSidebar) {
        closeProfile.addEventListener("click", function() {
            profileSidebar.classList.remove("open");
        });
    }

    // Close profile when clicking outside
    document.addEventListener("click", function(e) {
        if (profileSidebar && !profileSidebar.contains(e.target) && profileToggle && !profileToggle.contains(e.target)) {
            profileSidebar.classList.remove("open");
        }
    });
}

// ===========================
// CART BUTTON
// ===========================
function initializeCartButton() {
    const cartButton = document.getElementById("cart-button");
    if (cartButton) {
        cartButton.addEventListener("click", function() {
            window.location.href = "./cart/cart.html";
        });
    }
}

// ===========================
// INITIALIZE ON PAGE LOAD
// ===========================
document.addEventListener("DOMContentLoaded", function() {
    console.log("Page loaded, initializing...");
    
    // First, save products to localStorage for cart page
    saveProductsToStorage();
    
    // Then initialize everything else
    renderProducts();
    updateCartCount();
    initializeFilters();
    initializeProfileSidebar();
    initializeCartButton();
    
    // Debug: log initial cart state
    console.log("Initial cart:", getCart());
    console.log("Products saved to localStorage:", JSON.parse(localStorage.getItem('kfoods-products') || '[]').length);
    
    console.log("Initialization complete!");
});

// Add a global function to debug cart (useful for testing)
window.debugCart = function() {
    console.log("=== CART DEBUG INFO ===");
    console.log("LocalStorage key 'kfoods-cart':", localStorage.getItem('kfoods-cart'));
    console.log("Parsed cart:", getCart());
    console.log("Total items in cart:", getCart().reduce((sum, item) => sum + (item.quantity || 1), 0));
    console.log("LocalStorage key 'kfoods-products':", localStorage.getItem('kfoods-products') ? "Exists" : "Missing");
    console.log("=== END DEBUG ===");
};

// Optional: Auto-save products periodically to ensure cart page has latest data
setInterval(saveProductsToStorage, 30000); // Every 30 seconds
    </script>
</body>
</html>