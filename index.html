<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Foods Restaurant - Korean Delights</title>

    <!-- ICONS + CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>

<body>

    <header>
        <div class="logo">
            <img src="cart/karumata.png" class="brand-logo" />
            <h1>Karu-mata</h1>
        </div>

        <!-- RIGHT SIDE ICONS -->
        <div class="nav-icons">

            <div class="restaurant-info">
                <div class="info-item">
                    <i class="fas fa-clock"></i>
                    <span>Open: 10:00 AM â€“ 9:00 PM</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-bolt"></i>
                    <span>Meals ready in 15-20 minutes</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-motorcycle"></i>
                    <span>Delivery available</span>
                </div>
            </div>

            <!-- Cart Button -->
            <div class="btns">
                <button id="cart-button" class="cart-circle" onclick="window.location.href='cart.html'">
                    <i class="fas fa-shopping-bag"></i>
                    <span id="cart-count">0</span>
                </button>

                <!-- Profile Button -->
                <button id="profile-toggle" class="profile-circle">
                    <i class="fas fa-user"></i>
                </button>
            </div>

        </div>

    </header>

   <!-- FILTER SECTION -->
    <div class="main-container">
        <div class="filter-section">
            <h2 class="filter-title"><i class="fas fa-filter"></i> Filter by Category</h2>

            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="best">Best Sellers</button>
                <button class="filter-btn" data-filter="sushi">Sushi</button>
                <button class="filter-btn" data-filter="sizzling">Sizzling</button>
            </div>

        </div>

        <!-- PRODUCT SECTION -->
        <div class="content-wrapper">
            <div class="products-section">
                <h2 class="section-title"><i class="fas fa-store"></i> Korean Delights</h2>

                <div class="products-grid" id="products-grid">
                    <!-- JS inserts product cards here -->
                </div>
            </div>
        </div>
    </div>


    <footer>
        <p>Â© 2023 K-Foods Restaurant. All rights reserved.</p>
        <p>Experience authentic Korean flavors made with passion and tradition.</p>
    </footer>
    


    <!-- ============================= -->
    <!-- PROFILE SIDEBAR (Slide Right) -->
    <!-- ============================= -->

    <div id="profile-sidebar" class="profile-sidebar">

    <div class="profile-header">
        <div class="profile-avatar">
            <i class="fas fa-user-circle"></i>
        </div>

        <div class="profile-info">
            <h3 class="profile-name">Welcome, Guest!</h3>
            <p class="profile-email">guest@kfoods.com</p>

            <button class="login-btn">Sign In / Register</button>
        </div>

        <button class="close-profile">&times;</button>
    </div>

    <div class="profile-content">

        <div class="profile-section">
            <h4><i class="fas fa-map-marker-alt"></i> Delivery Location</h4>
            <p class="current-address">No address set yet</p>

            <button class="manage-address-btn">
                <i class="fas fa-edit"></i> Manage Addresses
            </button>
        </div>

        <div class="profile-section">
            <h4><i class="fas fa-history"></i> Order History</h4>
            <div id="order-history-list">
                <!-- Injected by JS -->
            </div>
        </div>

    </div>

    <div class="profile-footer">
        <button class="logout-btn"><i class="fas fa-sign-out-alt"></i> Log Out</button>
    </div>

</div>


    <script>
// ===========================
// PRODUCT DATA (CLEANED)
// ===========================
const products = [
    {
        id: 1,
        name: "Bibimbap",
        price: 129,
        category: ["best"],
        image: "src/Bibimbap.jpeg",
        rating: 4.8,
        reviews: 1200,
        orders: 1900,
        description: "A colorful and comforting Korean rice bowl topped with seasoned vegetables, marinated beef, fried egg, and spicy gochujang sauce. Served warm and mixed just before eating.",
        tags: ["ðŸ”¥ Bestseller", "â± 20â€“30 mins", "ðŸ· Free utensils"],
        spicy: "ðŸŒ¶ Spicy Â· Korean Rice Bowl",
        addons: [
            { name: "Extra Rice", description: "White rice", price: 20 },
            { name: "Extra Egg", description: "Sunny side up", price: 25 },
            { name: "Extra Cheese", description: "Mozzarella", price: 30 },
            { name: "Kimchi Side", description: "100g portion", price: 40 },
            { name: "Iced Tea", description: "Regular glass", price: 35 }
        ]
    },
    {
        id: 2,
        name: "Pokebowl",
        price: 129,
        category: ["best"],
        image: "src/PokeBowl.jpeg",
        rating: 4.7,
        reviews: 920,
        orders: 1500,
        description: "Savory fried rice with tangy kimchi, vegetables, and topped with a fried egg. A perfect blend of spicy and umami flavors.",
        tags: ["ðŸŒ¶ Spicy", "â± 15â€“20 mins", "ðŸ”¥ Popular"],
        spicy: "ðŸŒ¶ Spicy Â· Fried Rice",
        addons: [
            { name: "Extra Kimchi", description: "Fermented cabbage", price: 30 },
            { name: "Extra Egg", description: "Sunny side up", price: 25 },
            { name: "Pork Belly", description: "Grilled slices", price: 50 }
        ]
    },
    {
        id: 3,
        name: "Stirfried Fishcake (Sweet & Spicy)",
        category: ["best"],
        price: 100,
        image: "src/Stirfried_Fishcake.jpeg",
        rating: 4.5,
        reviews: 710,
        orders: 1000,
        description: "Korean stirfried eomuk in spicy sauce.",
        tags: ["ðŸŒ¶ï¸ Spicy", "â± 15â€“20 mins", "ðŸ‡°ðŸ‡· Korean"],
        spicy: "ðŸŒ¶ Spicy Â· Korean Street Food",
        addons: [
            { name: "Extra Fishcake", description: "100g", price: 40 },
            { name: "Spicy Level", description: "Adjustable", price: 0 },
            { name: "Rice Cakes", description: "Tteokbokki style", price: 35 },
            { name: "Kimchi", description: "Side dish", price: 25 }
        ]
    },
    {
        id: 4,
        name: "Porkchop w/ rice & salad",
        category: ["best"],
        price: 79,
        image: "src/Porkchop.jpeg",
        rating: 4.4,
        reviews: 890,
        orders: 1300,
        description: "Grilled porkchop with rice and salad.",
        tags: ["ðŸ– Grilled", "â± 25â€“35 mins", "ðŸ”¥ Bestseller"],
        spicy: "ðŸ– Juicy Â· Filipino Classic",
        addons: [
            { name: "Extra Pork", description: "100g", price: 55 },
            { name: "Extra Gravy", description: "Special sauce", price: 15 },
            { name: "Mashed Potatoes", description: "Creamy", price: 30 },
            { name: "Corn & Carrots", description: "Steamed", price: 20 }
        ]
    },
    {
        id: 5,
        name: "Hot & spicy chicken w/ drinks",
        category: ["best"],
        price: 110,
        image: "src/H&S_Chicken.jpeg",
        rating: 4.7,
        reviews: 950,
        orders: 1600,
        description: "Spicy chicken meal with drinks.",
        tags: ["ðŸ— Chicken", "â± 25â€“35 mins", "ðŸŒ¶ï¸ Spicy"],
        spicy: "ðŸŒ¶ Spicy Â· Fried Chicken",
        addons: [
            { name: "Extra Rice", description: "White rice", price: 20 },
            { name: "Extra Chicken", description: "2 pieces", price: 60 },
            { name: "Coleslaw", description: "Fresh salad", price: 25 },
            { name: "Soft Drinks", description: "330ml can", price: 30 }
        ]
    },
    {
        id: 6,
        name: "Chicken Roll Sushi",
        category: ["sushi"],
        price: 145,
        image: "src/Chicken_Roll.jpeg",
        rating: 4.6,
        reviews: 850,
        orders: 1400,
        description: "Crispy chicken roll wrapped in sushi rice.",
        tags: ["ðŸ£ Japanese", "â± 10â€“15 mins", "ðŸ— Chicken"],
        spicy: "ðŸ£ Fresh Â· Japanese Fusion",
        addons: [
            { name: "Extra Chicken", description: "100g", price: 40 },
            { name: "Extra Avocado", description: "Fresh slices", price: 25 },
            { name: "Spicy Mayo", description: "Extra serving", price: 15 },
            { name: "Miso Soup", description: "Regular bowl", price: 30 }
        ]
    },
    {
        id: 7,
        name: "Hot Roll Sushi",
        category: ["sushi"],
        price: 149,
        image: "src/Hot_Roll.jpeg",
        rating: 4.5,
        reviews: 780,
        orders: 1200,
        description: "Spicy shrimp tempura sushi roll.",
        tags: ["ðŸŒ¶ï¸ Spicy", "â± 10â€“15 mins", "ðŸ¤ Shrimp"],
        spicy: "ðŸŒ¶ Spicy Â· Japanese Fusion",
        addons: [
            { name: "Extra Shrimp", description: "3 pieces", price: 50 },
            { name: "Spicy Level", description: "Extra spicy", price: 10 },
            { name: "Tempura Flakes", description: "Extra crunchy", price: 15 },
            { name: "Green Tea", description: "Hot/Cold", price: 25 }
        ]
    },
    {
        id: 8,
        name: "Softshell Mango Sushi",
        category: ["sushi"],
        price: 149,
        image: "src/Softshell_Mango.jpeg",
        rating: 4.5,
        reviews: 750,
        orders: 1100,
        description: "Softshell crab with mango sushi.",
        tags: ["ðŸ¦€ Crispy", "â± 15â€“20 mins", "ðŸ¥­ Sweet"],
        spicy: "ðŸ£ Fresh Â· Japanese Fusion",
        addons: [
            { name: "Extra Crab", description: "Soft-shell", price: 60 },
            { name: "Extra Mango", description: "Fresh slices", price: 25 },
            { name: "Eel Sauce", description: "Drizzle", price: 15 },
            { name: "Sesame Seeds", description: "Toasted", price: 10 }
        ]
    },
    {
        id: 9,
        name: "Mango Sushi",
        category: ["sushi"],
        price: 69,
        image: "src/Mango.jpeg",
        rating: 4.4,
        reviews: 720,
        orders: 1100,
        description: "Sweet and fresh mango sushi.",
        tags: ["ðŸ¥­ Tropical", "â± 10â€“15 mins", "ðŸ¥‘ Vegetarian"],
        spicy: "ðŸ¥­ Tropical Â· Sweet Sushi",
        addons: [
            { name: "Extra Mango", description: "Fresh slices", price: 30 },
            { name: "Extra Avocado", description: "Creamy", price: 25 },
            { name: "Coconut Flakes", description: "Topping", price: 15 },
            { name: "Tropical Juice", description: "Mango/Pineapple", price: 35 }
        ]
    },
    {
        id: 10,
        name: "Onigiri",
        category: ["sushi"],
        price: 120,
        image: "src/Onigiri.jpeg",
        rating: 4.3,
        reviews: 680,
        orders: 980,
        description: "Japanese rice ball wrapped in nori.",
        tags: ["ðŸ™ Portable", "â± 5â€“10 mins", "ðŸ¥¢ Traditional"],
        spicy: "ðŸ™ Classic Â· Japanese Comfort Food",
        addons: [
            { name: "Extra Onigiri", description: "1 piece", price: 45 },
            { name: "Soy Sauce Pack", description: "Premium", price: 10 },
            { name: "Seaweed Sheets", description: "Extra", price: 15 },
            { name: "Japanese Tea", description: "Hot", price: 25 }
        ]
    },
    {
        id: 11,
        name: "Kimbap",
        category: ["sushi"],
        price: 89,
        image: "src/Kimbap.jpeg", // fixed image
        rating: 4.4,
        reviews: 650,
        orders: 950,
        description: "Korean-style maki rolls.",
        tags: ["ðŸ‡°ðŸ‡· Korean", "â± 10â€“15 mins", "ðŸ± Light meal"],
        spicy: "ðŸ‡°ðŸ‡· Korean Â· Rice Rolls",
        addons: [
            { name: "Extra Kimbap", description: "4 pieces", price: 40 },
            { name: "Pickled Radish", description: "Danmuji", price: 15 },
            { name: "Korean Tea", description: "Boricha", price: 20 },
            { name: "Sesame Oil", description: "Dipping sauce", price: 10 }
        ]
    },

    // ======================
    // SIZZLING
    // ======================
    {
        id: 12,
        name: "Pork Sisig",
        category: ["sizzling"],
        price: 129,
        image: "src/Pork_Sisig.jpeg",
        rating: 4.6,
        reviews: 820,
        orders: 1400,
        description: "Sizzling pork sisig topped with egg.",
        tags: ["ðŸ”¥ Sizzling", "â± 20â€“30 mins", "ðŸŒ¶ï¸ Spicy"],
        spicy: "ðŸŒ¶ Spicy Â· Filipino Sizzling",
        addons: [
            { name: "Extra Egg", description: "Sunny side up", price: 25 },
            { name: "Extra Rice", description: "White rice", price: 20 },
            { name: "Calamansi", description: "Citrus wedge", price: 5 },
            { name: "Soy Sauce", description: "Premium", price: 10 }
        ]
    },
    {
        id: 13,
        name: "Pepper Steak",
        category: ["sizzling"],
        price: 129,
        image: "src/PepperSteak.jpeg",
        rating: 4.5,
        reviews: 780,
        orders: 1200,
        description: "Beef steak cooked with pepper sauce.",
        tags: ["ðŸ¥© Steak", "â± 25â€“35 mins", "ðŸ› Creamy"],
        spicy: "ðŸ¥© Juicy Â· Pepper Steak",
        addons: [
            { name: "Extra Steak", description: "100g", price: 70 },
            { name: "Mashed Potatoes", description: "Creamy", price: 30 },
            { name: "Pepper Sauce", description: "Extra", price: 15 },
            { name: "Vegetables", description: "Steamed mix", price: 20 }
        ]
    },
    {
        id: 14,
        name: "Kimchi Pork",
        category: ["sizzling"],
        price: 129,
        image: "src/Kimchi_Pork.jpeg",
        rating: 4.4,
        reviews: 740,
        orders: 1100,
        description: "Sizzling pork cooked with kimchi.",
        tags: ["ðŸ‡°ðŸ‡· Korean", "â± 20â€“30 mins", "ðŸŒ¶ï¸ Spicy"],
        spicy: "ðŸŒ¶ Spicy Â· Korean Sizzling",
        addons: [
            { name: "Extra Kimchi", description: "100g", price: 30 },
            { name: "Extra Pork", description: "100g", price: 50 },
            { name: "Steamed Rice", description: "White rice", price: 20 },
            { name: "Bean Sprouts", description: "Kongnamul", price: 15 }
        ]
    },
    {
        id: 15,
        name: "Teriyaki",
        category: ["sizzling"],
        price: 129,
        image: "src/TeriyakiSizzling.jpeg",
        rating: 4.3,
        reviews: 710,
        orders: 1000,
        description: "Sweet glazed teriyaki meat.",
        tags: ["ðŸ‡¯ðŸ‡µ Japanese", "â± 20â€“30 mins", "ðŸ¯ Sweet"],
        spicy: "ðŸ¯ Sweet Â· Japanese Glaze",
        addons: [
            { name: "Extra Meat", description: "Chicken/Beef", price: 55 },
            { name: "Teriyaki Sauce", description: "Extra glaze", price: 15 },
            { name: "Steamed Vegetables", description: "Mixed", price: 25 },
            { name: "Miso Soup", description: "Regular bowl", price: 30 }
        ]
    },
    {
        id: 16,
        name: "Spicy Garlic Shrimp",
        category: ["sizzling"],
        price: 129,
        image: "src/SpicyGarlicShrimp.jpeg",
        rating: 4.5,
        reviews: 760,
        orders: 1200,
        description: "Shrimp cooked in spicy garlic butter.",
        tags: ["ðŸ¦ Shrimp", "â± 15â€“25 mins", "ðŸŒ¶ï¸ Spicy"],
        spicy: "ðŸŒ¶ Spicy Â· Garlic Shrimp",
        addons: [
            { name: "Extra Shrimp", description: "5 pieces", price: 60 },
            { name: "Garlic Butter", description: "Extra sauce", price: 20 },
            { name: "Steamed Rice", description: "White rice", price: 20 },
            { name: "Lemon Wedge", description: "Fresh", price: 5 }
        ]
    }
];

// ===========================
// GLOBALS
// ===========================
let currentProduct = null;
let modalQuantity = 1;

// ===========================
// CART HELPERS
// ===========================
function getCart() {
    return JSON.parse(localStorage.getItem("kfoods-cart") || "[]");
}

function saveCart(cart) {
    localStorage.setItem("kfoods-cart", JSON.stringify(cart));
}

function updateCartCount() {
    const cartCountEl = document.getElementById("cart-count");
    if (cartCountEl) {
        const cart = getCart();
        const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
        cartCountEl.textContent = totalItems || 0;
    }
}

// Save products to localStorage for cart page access
function saveProductsToStorage() {
    const productsForCart = products.map(product => {
        const catArr = Array.isArray(product.category) ? product.category : [product.category];
        const mainCat = catArr[0] || "best";

        return {
            id: product.id,
            name: product.name,
            price: product.price,
            description: product.description,
            category: mainCat,
            bestSeller: catArr.includes("best"),
            icon: getIconForCategory(mainCat)
        };
    });

    localStorage.setItem("kfoods-products", JSON.stringify(productsForCart));
}

// Helper function to get icon based on category
function getIconForCategory(category) {
    const iconMap = {
        best: "fas fa-star",
        sizzling: "fas fa-fire",
        sushi: "fas fa-fish",
        meal: "fas fa-bowl-rice",
        side: "fas fa-utensils",
        snack: "fas fa-mortar-pestle"
    };
    return iconMap[category] || "fas fa-utensils";
}

// ===========================
// RENDER PRODUCTS
// ===========================
function renderProducts(filter = "all") {
    const grid = document.getElementById("products-grid");
    if (!grid) return;

    grid.innerHTML = "";

    const filtered = products.filter(p => {
        if (filter === "all") return true;
        const catArr = Array.isArray(p.category) ? p.category : [p.category];
        return catArr.includes(filter);
    });

    filtered.forEach(product => {
        const card = document.createElement("div");
        card.className = "product-card";
        card.style.cursor = "pointer";

        card.innerHTML = `
            <div class="product-image">
                <img src="${product.image}" alt="${product.name}" loading="lazy">
            </div>
            <div class="product-content">
                <h3 class="product-title">${product.name}</h3>
                <p class="product-description">${product.description.substring(0, 80)}...</p>
                <div class="product-footer">
                    <div class="product-price">â‚±${product.price.toFixed(2)}</div>
                    <button class="add-btn" onclick="event.stopPropagation(); openProductModal(${product.id})">
                        + Add
                    </button>
                </div>
            </div>
        `;

        card.addEventListener("click", () => openProductModal(product.id));
        grid.appendChild(card);
    });
}

// ===========================
// PRODUCT MODAL
// ===========================
function openProductModal(productId) {
    currentProduct = products.find(p => p.id === productId);
    if (!currentProduct) return;

    modalQuantity = 1;

    const existingModal = document.getElementById("productModalBackdrop");
    if (existingModal) existingModal.remove();

    const reviewsText = typeof currentProduct.reviews === "number"
        ? currentProduct.reviews.toLocaleString()
        : currentProduct.reviews;

    const ordersText = typeof currentProduct.orders === "number"
        ? `${currentProduct.orders.toLocaleString()}+`
        : currentProduct.orders;

    const modalHTML = `
        <div id="productModalBackdrop" class="modal-backdrop show">
            <div class="modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <div class="modal-title">${currentProduct.name}</div>
                    <button class="modal-close" onclick="closeProductModal()">&times;</button>
                </div>
                
                <div class="modal-sub">
                    ${currentProduct.spicy}
                </div>
                
                <div style="margin-bottom: 12px;">
                    <span style="color: #ffb000; font-size: 16px;">â˜…</span>
                    <span style="font-size: 13px; color: #777;">
                        ${currentProduct.rating} (${reviewsText} reviews)
                    </span>
                    <span style="font-size: 13px; color: #777;"> â€¢ </span>
                    <span style="font-size: 13px; color: #777;">
                        ${ordersText} orders this week
                    </span>
                </div>
                
                <div style="font-size: 22px; font-weight: 700; color: #d32f2f; margin-bottom: 12px;">
                    â‚±${currentProduct.price.toFixed(2)}
                </div>
                
                <p style="font-size: 14px; color: #666; line-height: 1.6; margin-bottom: 12px;">
                    ${currentProduct.description}
                </p>
                
                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px;">
                    ${currentProduct.tags.map(tag => `<span class="info-tag">${tag}</span>`).join("")}
                </div>

                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding: 12px; background: #f9f9f9; border-radius: 12px;">
                    <span style="font-size: 14px; font-weight: 500; color: #333;">Quantity</span>
                    <div class="qty-box">
                        <button class="qty-btn" onclick="changeModalQty(-1)">âˆ’</button>
                        <input type="number" id="modalQtyInput" class="qty-input" value="1" min="1" readonly>
                        <button class="qty-btn" onclick="changeModalQty(1)">+</button>
                    </div>
                </div>

                <div>
                    <div class="modal-section-title">Add-ons (Optional)</div>
                    <ul class="addons-list" id="modalAddonsList">
                        ${currentProduct.addons.map((addon, index) => `
                            <li class="addons-item">
                                <label>
                                    <input type="checkbox" class="addon-checkbox" data-index="${index}" onchange="updateModalTotal()">
                                    ${addon.name}
                                    <small>${addon.description}</small>
                                </label>
                                <span>+ â‚±${addon.price}</span>
                            </li>
                        `).join("")}
                    </ul>
                </div>
                
                <div class="modal-footer">
                    <div>
                        <div class="total-label">Total to pay</div>
                        <div class="total-value" id="modalTotalPrice">â‚±${currentProduct.price.toFixed(2)}</div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button class="btn-secondary" onclick="closeProductModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="confirmAddToCart()" style="font-size:13px;">
                            Add to Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;

    document.body.insertAdjacentHTML("beforeend", modalHTML);

    document.getElementById("productModalBackdrop").addEventListener("click", e => {
        if (e.target.id === "productModalBackdrop") closeProductModal();
    });

    document.body.style.overflow = "hidden";
    updateModalTotal();
}

function closeProductModal() {
    const backdrop = document.getElementById("productModalBackdrop");
    if (backdrop) {
        backdrop.classList.remove("show");
        setTimeout(() => backdrop.remove(), 300);
        document.body.style.overflow = "auto";
    }
}

function changeModalQty(delta) {
    modalQuantity = Math.max(1, modalQuantity + delta);
    const qtyInput = document.getElementById("modalQtyInput");
    if (qtyInput) qtyInput.value = modalQuantity;
    updateModalTotal();
}

function updateModalTotal() {
    if (!currentProduct) return;

    let addonsTotal = 0;
    document.querySelectorAll(".addon-checkbox").forEach(cb => {
        if (cb.checked) {
            const index = parseInt(cb.dataset.index, 10);
            addonsTotal += currentProduct.addons[index].price;
        }
    });

    const perUnit = currentProduct.price + addonsTotal;
    const total = perUnit * modalQuantity;

    const totalEl = document.getElementById("modalTotalPrice");
    if (totalEl) totalEl.textContent = `â‚±${total.toFixed(2)}`;
}

function confirmAddToCart() {
    if (!currentProduct) return;

    let selectedAddons = [];
    let addonsTotal = 0;

    document.querySelectorAll(".addon-checkbox").forEach(cb => {
        if (cb.checked) {
            const index = parseInt(cb.dataset.index, 10);
            const addon = currentProduct.addons[index];
            addonsTotal += addon.price;
            selectedAddons.push({ name: addon.name, price: addon.price });
        }
    });

    const perUnit = currentProduct.price + addonsTotal;
    const cart = getCart();

    const existingIndex = cart.findIndex(item =>
        item.id === currentProduct.id &&
        JSON.stringify(item.addons || []) === JSON.stringify(selectedAddons)
    );

    if (existingIndex !== -1) {
        cart[existingIndex].quantity = (cart[existingIndex].quantity || 1) + modalQuantity;
    } else {
        cart.push({
            id: currentProduct.id,
            name: currentProduct.name,
            price: perUnit,
            quantity: modalQuantity,
            addons: selectedAddons,
            basePrice: currentProduct.price
        });
    }

    saveCart(cart);
    updateCartCount();
    closeProductModal();
    showToast("âœ… Successfully Added to Cart!");
}

function showToast(message) {
    let toast = document.getElementById("toastNotification");
    if (!toast) {
        toast = document.createElement("div");
        toast.id = "toastNotification";
        toast.className = "toast";
        document.body.appendChild(toast);
    }
    toast.textContent = message;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 2800);
}

// ===========================
// FILTERS
// ===========================
function initializeFilters() {
    const filterBtns = document.querySelectorAll(".filter-btn");
    filterBtns.forEach(btn => {
        btn.addEventListener("click", function () {
            filterBtns.forEach(b => b.classList.remove("active"));
            this.classList.add("active");
            renderProducts(this.dataset.filter);
        });
    });
}

// ===========================
// PROFILE SIDEBAR (INDEX PAGE)
// ===========================
document.addEventListener("DOMContentLoaded", function () {
    const profileToggle = document.getElementById("profile-toggle");
    const sidebar = document.getElementById("profile-sidebar");
    const closeProfileBtn = document.querySelector(".close-profile");

    if (!profileToggle || !sidebar || !closeProfileBtn) return;

    profileToggle.addEventListener("click", e => {
        e.stopPropagation();
        sidebar.classList.add("open");
    });

    closeProfileBtn.addEventListener("click", () => {
        sidebar.classList.remove("open");
    });

    document.addEventListener("click", e => {
        if (!sidebar.contains(e.target) && !profileToggle.contains(e.target)) {
            sidebar.classList.remove("open");
        }
    });

    // Load address
    const savedAddress = localStorage.getItem("kfoods-address") || "No address set yet";
    const addressEl = document.querySelector(".current-address");
    if (addressEl) addressEl.textContent = savedAddress;

    // Load order history
    const historyBox = document.getElementById("order-history-list");
    const transactions = JSON.parse(localStorage.getItem("kfoods-transactions") || "[]");

    if (historyBox) {
        if (transactions.length === 0) {
            historyBox.innerHTML = "<p>No previous orders.</p>";
        } else {
            historyBox.innerHTML = transactions.map(t => `
                <div class="order-item">
                    <p>Order #${t.id} â€” ${t.items.length} item(s)</p>
                    <span>P${t.total}</span>
                </div>
            `).join("");
        }
    }
});

// ===========================
// CART BUTTON
// ===========================
function initializeCartButton() {
    const cartButton = document.getElementById("cart-button");
    if (cartButton) {
        cartButton.addEventListener("click", () => {
            // NOTE: keep same path as your HTML inline onclick
            window.location.href = "cart.html";
        });
    }
}

// ===========================
// MAIN INITIALIZER
// ===========================
document.addEventListener("DOMContentLoaded", function () {
    saveProductsToStorage();
    renderProducts();
    updateCartCount();
    initializeFilters();
    initializeCartButton();
});

// ===========================
// ADDRESS MODAL (INDEX PAGE)
// ===========================
document.addEventListener("DOMContentLoaded", function () {
    const manageBtn = document.querySelector(".manage-address-btn");
    const addressModal = document.getElementById("addressModal");
    const saveBtn = document.querySelector(".save-address-btn");
    const closeBtn = document.querySelector(".close-address-btn");

    if (!manageBtn || !addressModal || !saveBtn || !closeBtn) return;

    manageBtn.addEventListener("click", () => {
        addressModal.style.display = "flex";
    });

    closeBtn.addEventListener("click", () => {
        addressModal.style.display = "none";
    });

    saveBtn.addEventListener("click", () => {
        const street = document.getElementById("addrStreet").value;
        const brgy   = document.getElementById("addrBarangay").value;
        const city   = document.getElementById("addrCity").value;
        const zip    = document.getElementById("addrZip").value;

        const address = `${street}, ${brgy}, ${city} ${zip}`.trim();
        localStorage.setItem("kfoods-address", address);

        const addressEl = document.querySelector(".current-address");
        if (addressEl) addressEl.textContent = address || "No address set yet";

        addressModal.style.display = "none";
        showToast("âœ” Address Saved!");
    });
});

// Debug helper
window.debugCart = function () {
    console.log("=== CART DEBUG INFO ===");
    console.log("Raw localStorage:", localStorage.getItem("kfoods-cart"));
    console.log("Parsed cart:", getCart());
    console.log("Total items:", getCart().reduce((sum, item) => sum + (item.quantity || 1), 0));
    console.log("Products stored:", JSON.parse(localStorage.getItem("kfoods-products") || "[]").length);
    console.log("=== END DEBUG ===");
};

// Optional: keep products in sync
setInterval(saveProductsToStorage, 30000);
document.addEventListener("DOMContentLoaded", function () {

    // SIGN IN / REGISTER BUTTON
    const loginBtn = document.querySelector(".login-btn");
    if (loginBtn) {
        loginBtn.addEventListener("click", function () {
            window.location.href = "log-in.html";  
        });
    }

    // LOGOUT BUTTON
    const logoutBtn = document.querySelector(".logout-btn");
    if (logoutBtn) {
        logoutBtn.addEventListener("click", function () {

            // CLEAR USER SESSION IF YOU ADD LOGIN SYSTEM LATER
            localStorage.removeItem("kfoods-user");

            // Redirect back to login page
            window.location.href = "log-in.html";
        });
    }

});
fetch("php/login.php", {
    method: "POST",
    body: new FormData(form)
})
.then(res => res.text())
.then(data => {
    if (data === "SUCCESS") {
        window.location.href = "index.html";
    } else {
        alert("Invalid login");
    }
});


</script>




<div id="addressModal" class="address-modal">
    <div class="address-modal-content">
        <h2>Manage Address</h2>

        <label>Street</label>
        <input type="text" id="addrStreet" placeholder="Street / House No.">

        <label>Barangay</label>
        <input type="text" id="addrBarangay" placeholder="Barangay">

        <label>City</label>
        <input type="text" id="addrCity" placeholder="City">

        <label>ZIP Code</label>
        <input type="text" id="addrZip" placeholder="ZIP">

        <button class="save-address-btn">Save Address</button>
        <button class="close-address-btn">Close</button>
    </div>
</div>
</body>
</html>